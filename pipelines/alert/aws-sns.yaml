---
# Description
#   The Sensu AWS SNS Handler is a Sensu Event Handler that alerts to
#   the AWS Simple Notification Service (SNS).
#
# Instructions
#   1. Add "aws-sns" to the "alert" handler set.
#
#      To create the "alert" handler set, please run:
#
#      $ sensuctl handler create alert --type set --handlers aws-sns
#
#      If you already have a handler set called "alert", please run:
#
#      $ sensuctl edit handler alert
#
#      NOTE: the sensuctl edit command will open your default editor; please
#      modify the "handlers" attribute by adding "aws-sns".
#
#   2. If using the AWS environment variables for credentails (and not using
#      them from the ~/.aws/credentials file or an EC2 IAM role), configure the
#      following secrets using your preferred Sensu Go Secrets provider:
#
#      - aws_secret_access_key
#      - aws_access_key_id
#      - aws_region
#
#      Regardless of AWS credentials above, either configure the following
#      secret using your secrets provider, or remove it from the secrets
#      definitions and provide the topic ARN via the --topic-arn argument
#      to the command:
#
#      - sns_topic_arn
#
#      NOTE: example secret resources using the "env" provider are included in
#      this template; to add your secrets to the Sensu Backend, please modify
#      /etc/default/sensu-backend or /etc/sysconfig/sensu-backend and restart
#      the sensu-backend service.
#
#   3. More configuration options are available for this plugin; please see the
#      plugin documentation for more details.
#
# Documentation
#   - https://github.com/sensu/sensu-aws-sns-handler#sensu-aws-sns-handler
#   - https://docs.sensu.io/sensu-go/latest/reference/secrets/
#
# Contributors
#   The following individuals have contributed to this configuration template:
#   - Todd Campbell, @nixwiz
type: Handler
api_version: core/v2
metadata:
  name: aws-sns
spec:
  command: sensu-aws-sns-handler
  env_vars: null
  filters:
    - is_incident
    - not_silenced
  handlers: null
  runtime_assets:
    - sensu/sensu-aws-sns-handler:0.3.0
  secrets:
    - name: AWS_SECRET_ACCESS_KEY
      secret: aws_secret_access_key
    - name: AWS_ACCESS_KEY_ID
      secret: aws_access_key_id
    - name: AWS_REGION
      secret: aws_region
    - name: SNS_TOPIC_ARN
      secret: sns_topic_arn
  timeout: 0
  type: pipe
---
type: Secret
api_version: secrets/v1
metadata:
  name: aws_secret_access_key
spec:
  provider: env
  id: AWS_SECRET_ACCESS_KEY
---
type: Secret
api_version: secrets/v1
metadata:
  name: aws_access_key_id
spec:
  provider: env
  id: AWS_ACCESS_KEY_ID
---
type: Secret
api_version: secrets/v1
metadata:
  name: aws_region
spec:
  provider: env
  id: AWS_REGION
---
type: Secret
api_version: secrets/v1
metadata:
  name: sns_topic_arn
spec:
  provider: env
  id: SNS_TOPIC_ARN
---
type: Asset
api_version: core/v2
metadata:
  name: sensu-aws-sns-handler:0.3.0
  labels:
  annotations:
    io.sensu.bonsai.url: https://bonsai.sensu.io/assets/sensu/sensu-aws-sns-handler
    io.sensu.bonsai.api_url: https://bonsai.sensu.io/api/v1/assets/sensu/sensu-aws-sns-handler
    io.sensu.bonsai.tier: Community
    io.sensu.bonsai.version: 0.3.0
    io.sensu.bonsai.namespace: sensu
    io.sensu.bonsai.name: sensu-aws-sns-handler
    io.sensu.bonsai.tags: aws, handler
spec:
  - url: https://assets.bonsai.sensu.io/fb3a5096b2a15d190d9b23fe1596328b3a27fc3e/sensu-aws-sns-handler_0.3.0_windows_amd64.tar.gz
    sha512: 336fc3e78851967661394d6714e592f195ac696f630edf41fdcd996466957411d38788c5173dc41a3ca3a663747dcc947359d09a9abe54f137866bb9abd07201
    filters:
      - entity.system.os == 'windows'
      - entity.system.arch == 'amd64'
  - url: https://assets.bonsai.sensu.io/fb3a5096b2a15d190d9b23fe1596328b3a27fc3e/sensu-aws-sns-handler_0.3.0_darwin_amd64.tar.gz
    sha512: be9a57d5f705a8326c07b99a5ae274d92324e2ad28427dcff9e48c16fdcf39c2cf6fa18fcd62c8352a0eae4ec629a368f309abebe3fde81064d4e3b706a96b1b
    filters:
      - entity.system.os == 'darwin'
      - entity.system.arch == 'amd64'
  - url: https://assets.bonsai.sensu.io/fb3a5096b2a15d190d9b23fe1596328b3a27fc3e/sensu-aws-sns-handler_0.3.0_linux_armv7.tar.gz
    sha512: 6dc9b21cfad70bd458570ac4fd245b2d4a83ce6eda9f777aba04575a8ad90dc45631d5ce35a74192a719b93440695b92c453937df4de07cb45772fe827a5ab6e
    filters:
      - entity.system.os == 'linux'
      - entity.system.arch == 'armv7'
  - url: https://assets.bonsai.sensu.io/fb3a5096b2a15d190d9b23fe1596328b3a27fc3e/sensu-aws-sns-handler_0.3.0_linux_arm64.tar.gz
    sha512: a76195d0fcf29a3b4d518bca29eb2f5cd84e6612437a791acfde3e240a0a6dfe68d1b74cdb06cba0069c9f1d68b9cded67440579752c4438ccc71880c63a7de1
    filters:
      - entity.system.os == 'linux'
      - entity.system.arch == 'arm64'
  - url: https://assets.bonsai.sensu.io/fb3a5096b2a15d190d9b23fe1596328b3a27fc3e/sensu-aws-sns-handler_0.3.0_linux_386.tar.gz
    sha512: c312de3a4f5f22d224a5d943b3eb9f5bd567d4e38db9db82f72bd99f9835ba3c8f66f95c07ba46dea6aa7169b1f8b35d7da00eac742097fb676547cbfdb5606d
    filters:
      - entity.system.os == 'linux'
      - entity.system.arch == '386'
  - url: https://assets.bonsai.sensu.io/fb3a5096b2a15d190d9b23fe1596328b3a27fc3e/sensu-aws-sns-handler_0.3.0_linux_amd64.tar.gz
    sha512: 0007f7dbe1a9cc5c040a07a0c1e74a74a23b233c0b5eab0b86f60cedb35272486eabb9e27e9cb28c965af0825991b0284c23af7bdcd9c8244f90c2ac622523b7
    filters:
      - entity.system.os == 'linux'
      - entity.system.arch == 'amd64'
