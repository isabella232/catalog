---
# Description
#   The Sensu ServiceNow Handler is a Sensu Event Handler that alerts to
#   ServiceNow's Incident Management product.
#
# Instructions
#   1. Add "servicenow-incident" to the "incident-management" handler set.
#
#      To create the "incident-management" handler set, please run:
#
#      $ sensuctl handler create incident-management --type set --handlers servicenow-incident
#
#      If you already have a handler set called "incident-management", please run:
#
#      $ sensuctl edit handler incident-management
#
#      NOTE: the sensuctl edit command will open your default editor; please
#      modify the "handlers" attribute by adding "servicenow-incident".
#
#   2. Configure the following secrets using your preferred Sensu Go Secrets
#      provider:
#
#      - servicenow_host
#      - servicenow_username
#      - servicenow_password
#
#      NOTE: example secret resources using the "env" provider are included in
#      this template; to add your secrets to the Sensu Backend, please modify
#      /etc/default/sensu-backend or /etc/sysconfig/sensu-backend and restart
#      the sensu-backend service.
#
#   3. More configuration options are available for this plugin; please see the
#      plugin documentation for more details.
#
# Documentation
#   - https://github.com/sensu/sensu-servicenow-handler#sensu-servicenow-handler
#   - https://docs.sensu.io/sensu-go/latest/reference/secrets/
#
# Contributors
#   The following individuals have contributed to this configuration template:
#   - Todd Campbell, @nixwiz
type: Handler
api_version: core/v2
metadata:
  name: servicenow-incident
spec:
  command: >-
    sensu-servicenow-handler
    --incidentTable incident
  env_vars: null
  filters:
    - is_incident
    - not_silenced
  handlers: null
  runtime_assets:
    - sensu/sensu-servicenow-handler:2.1.0
  secrets:
    - name: SERVICENOW_HOST
      secret: servicenow_host
    - name: SERVICENOW_USERNAME
      secret: servicenow_username
    - name: SERVICENOW_PASSWORD
      secret: servicenow_password
  timeout: 0
  type: pipe
---
type: Secret
api_version: secrets/v1
metadata:
  name: servicenow_username
spec:
  provider: env
  id: SERVICENOW_USERNAME
---
type: Secret
api_version: secrets/v1
metadata:
  name: servicenow_password
spec:
  provider: env
  id: SERVICENOW_PASSWORD
---
type: Secret
api_version: secrets/v1
metadata:
  name: servicenow_host
spec:
  provider: env
  id: SERVICENOW_HOST
---
type: Asset
api_version: core/v2
metadata:
  name: sensu/sensu-servicenow-handler:2.1.0
  labels:
  annotations:
    io.sensu.bonsai.url: https://bonsai.sensu.io/assets/sensu/sensu-servicenow-handler
    io.sensu.bonsai.api_url: https://bonsai.sensu.io/api/v1/assets/sensu/sensu-servicenow-handler
    io.sensu.bonsai.tier: Enterprise
    io.sensu.bonsai.version: 2.1.0
    io.sensu.bonsai.namespace: sensu
    io.sensu.bonsai.name: sensu-servicenow-handler
    io.sensu.bonsai.tags: handler, hosted
    io.sensu.bonsai.message: This asset is for users with a valid Enterprise license
spec:
  builds:
  - url: https://assets.bonsai.sensu.io//sensu-servicenow-handler_2.1.0_windows_amd64.tar.gz
    sha512: adc9c81e6bb8a0f509817185685235ab404bd9c37a54517d1e4aefac444fb8244106da060d3d574936dc5527382b7395247baa28c6d3de27376bbefd8cd92a17
    filters:
    - entity.system.os == 'windows'
    - entity.system.arch == 'amd64'
  - url: https://assets.bonsai.sensu.io//sensu-servicenow-handler_2.1.0_darwin_amd64.tar.gz
    sha512: 16b301fe8270e30ce45e1344c9a7728aa4f5e1e453638db94cb63ff23482f32f70b3bf98c62e239ad96180a26dbdb5131b889fe0ac86e38115e8417cd3b1dc2b
    filters:
    - entity.system.os == 'darwin'
    - entity.system.arch == 'amd64'
  - url: https://assets.bonsai.sensu.io//sensu-servicenow-handler_2.1.0_linux_armv7.tar.gz
    sha512: 92a21e65e8fdc0cfd413c05fcad894278652f1db63a26e5e37ac4c57283b780359ce0f5c13ba4bda611ff9c75f733a5fcafdc018400a26fe10642391418596d1
    filters:
    - entity.system.os == 'linux'
    - entity.system.arch == 'armv7'
  - url: https://assets.bonsai.sensu.io//sensu-servicenow-handler_2.1.0_linux_arm64.tar.gz
    sha512: e47bb025f5e3ef1dd1acd487f9ca92d732ad861698f9967674220e8c634d7ba41937304c246325f27030da212e600c2261ee070260251c960d43398cf3ca9552
    filters:
    - entity.system.os == 'linux'
    - entity.system.arch == 'arm64'
  - url: https://assets.bonsai.sensu.io//sensu-servicenow-handler_2.1.0_linux_386.tar.gz
    sha512: 5a949a49b62c964f7a66153042173478f0cae3893d09cd833558bf3cb14917abaafc8d00b4553d7dbff26d9d1f46e70520bb0f31db3679c914d70412594aca95
    filters:
    - entity.system.os == 'linux'
    - entity.system.arch == '386'
  - url: https://assets.bonsai.sensu.io//sensu-servicenow-handler_2.1.0_linux_amd64.tar.gz
    sha512: a3406550e2d5e80792d4744b1584d3302791d3a1b4023269c8c8aab4f3fa3dcd63d765d8170afbac7790c084542dd972f7d322548cb8bb62d2120b97160c59a0
    filters:
    - entity.system.os == 'linux'
    - entity.system.arch == 'amd64'