---
api_version: catalog/v1
type: Integration
metadata:
  namespace: microsoft-teams
  name: microsoft-teams-alerts
spec:
  class: enterprise
  provider: alerts
  display_name: microsoft-teams-alerts
  short_description: Sends alerts to Microsoft Teams Channels
  supported_platforms:
    - linux
  tags:
    - teams
    - alerts
    - incidents
  contributors:
    - "@sensu"
  prompts:
    - type: section
      title: Secrets Management
    - type: markdown
      body: |
        This integration requires a Microsoft Teams Webhook URL.
    - type: question
      name: secret_provider
      input:
        type: string
        title: Secret Provider
        enum:
          - env
          - vault
        default: env
    - type: question
      name: microsoft_teams_webhook_url_secret
      input:
        type: string
        title: Secret ID
        description: >-
          Provide the Secret identifier (i.e. environment variable name, or Vault secret key/path)
        default: MICROSOFT_TEAMS_WEBHOOK_URL
    - type: section
      title: Alert Format
    - type: markdown
      body: |
        The sensu-microsoft-teams-handler provides options to customize the alert appearance.

        Refer to the [sensu-microsoft-teams-handler docs][docs] for more details.

        [docs](https://bonsai.sensu.io/assets/sensu/sensu-microsoft-teams-handler#templates)
    - type: question
      name: title_template
      input:
        type: string
        title: Title Template
        description: >-
          The Alert Title Template
        default: "Sensu Event - {{.Entity.Name}}/{{.Check.Name}}"
    - type: question
      name: icon_url
      input:
        type: string
        title: Icon URL
        description: >-
          URL of the icon displayed with the alert
        default: https://www.sensu.io/img/sensu-logo.png
  resource_patches:
    - resource:
        api_version: secrets/v1
        type: Secret
        name: microsoft_teams_webhook_url
      patches:
        - path: /spec/provider
          op: replace
          value: "[[secret_provider]]"
        - path: /spec/id
          op: replace
          value: "[[microsoft_teams_webhook_url_secret]]"
    - resource:
        api_version: core/v2
        type: Handler
        name: ms-teams-alerts
      patches:
        - path: /spec/command
          op: replace
          value: >-
            sensu-microsoft-teams-handler
            --icon-url [[icon_url]]
            --title-template "[[title_template]]"

