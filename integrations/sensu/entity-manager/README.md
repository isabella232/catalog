## Overview

<!-- Sensu Integration description; supports markdown -->

The Sensu Entity Manager integration provides automated management of agent subscriptions, labels, and annotations. 

The Sensu Entity Manager works with any check or event producer that generates one instruction per line of `event.check.output` in any of the following formats:

* **Subscriptions** 

  One subscription per line.

  ```
  system/linux
  postgres
  ```

* **Labels & Annotations** 

  One key=value pair per line.

  ```
  region=us-west-1
  app_id=1234
  ```

* **Mix of subscriptions, labels, and annotations**

  One command per line. 

  ```
  add-subscription system/linux
  add-subscription postgres
  add-label region=us-west-1
  add-annotation application_id=1234
  ```

For more information, please visit the [sensu/sensu-entity-manager][sensu-entity-manager-github] project on GitHub.

## Dashboards

<!-- List of compatible dashboards w/ screenshots (supports png, jpeg, and gif images; relative paths only; e.g. `![](img/dashboard-1.png)` )-->

There are no compatible dashboards for this integration.

## Setup

<!-- Sensu Integration setup instructions, including Sensu agent configuration and external component configuration -->
<!-- EXAMPLE: what configuration (if any) is required in a third-party service to enable monitoring? -->

1. **Create an API Key for use with this integration, optionally including a dedicated "service account" user.**

   Create an "entity-manager" service account (i.e. [role], [role-binding], and [user]):

   ```
   sensuctl role create entity-manager --verb=update --resource entities
   sensuctl role-binding create entity-manager --role=entity-manager --user=entity-manager
   sensuctl user create entity-manager --password $(openssl rand -hex 16)
   sensuctl api-key grant entity-manager
   ```

   _NOTE: "service account users should be used for automation purposes only, with api-keys for authentication.
   Generating and discarding a random password (e.g. `openssl rand -hex 16` or `uuid -v4`) is appropriate in this context._

   The `sensuctl api-key grant` command should produce a response containing a 36-character UUID v4 formatted string:

   ```
   Created: /api/core/v2/apikeys/xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx
   ```

   Copy the `xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx` portion of the output.

   If you are unable to generate a `role`, `role-binding`, `user`, and/or `api-key`, please contact your Sensu administrator.

## Plugins

<!-- Links to any Sensu Integration dependencies (i.e. Sensu Plugins) -->

- [sensu/sensu-entity-manager][sensu-entity-manager-bonsai] ([GitHub][sensu-entity-manager-github])

## Metrics & Events

<!-- List of all metrics or events collected by this integration. -->

This integration does not produce any [metrics].

## Alerts

<!-- List of all alerts generated by this integration. -->

<!-- This integration provides an alert & incident management processing pipeline for use with other monitoring integrations. By default this integration will process all events passing the [built-in `is_incident` filter][is_incident] (i.e. failing events and resolution events only). Event processing via this integration may be suppressed using [Sensu Silencing][silences] (see the [built-in `not_silenced` filter][not_silenced] for more details). -->

This integration does not produce any events that should be processed by an alert or incident management [pipeline].

## Reference Documentation

<!-- Please provide links to any relevant reference documentation to help users learn more and/or troubleshoot this integration; specifically including any third-party software documentation. -->

1. [Role-Based Access Controls (RBAC) for Sensu Go][rbac]
1. [Sensu Subscriptions][subscriptions]

<!-- Links -->
[check]: https://docs.sensu.io/sensu-go/latest/observability-pipeline/observe-schedule/checks/
[asset]: https://docs.sensu.io/sensu-go/latest/plugins/assets/
[subscription]: https://docs.sensu.io/sensu-go/latest/observability-pipeline/observe-schedule/subscriptions/
[subscriptions]: https://docs.sensu.io/sensu-go/latest/observability-pipeline/observe-schedule/subscriptions/
[agents]: https://docs.sensu.io/sensu-go/latest/observability-pipeline/observe-schedule/agent/
[annotation]: https://docs.sensu.io/sensu-go/latest/observability-pipeline/observe-schedule/agent/#general-configuration-flags
[plugins]: https://docs.sensu.io/sensu-go/latest/plugins/
[metrics]: https://docs.sensu.io/sensu-go/latest/observability-pipeline/observe-schedule/metrics/
[pipeline]: https://docs.sensu.io/sensu-go/latest/observability-pipeline/observe-process/pipelines/
[handler]: https://docs.sensu.io/sensu-go/latest/observability-pipeline/observe-process/handlers/
[secret]: https://docs.sensu.io/sensu-go/latest/operations/manage-secrets/secrets/
[secrets]: https://docs.sensu.io/sensu-go/latest/operations/manage-secrets/secrets/
[tokens]: https://docs.sensu.io/sensu-go/latest/observability-pipeline/observe-schedule/tokens/
[handler-templating]: https://docs.sensu.io/sensu-go/latest/observability-pipeline/observe-process/handler-templates/
[sensu-plus]: https://sensu.io/features/analytics
[sensu-entity-manager-bonsai]: https://bonsai.sensu.io/assets/sensu/sensu-entity-manager
[sensu-entity-manager-github]: https://github.com/sensu/sensu-entity-manager
[rbac]: https://docs.sensu.io/sensu-go/latest/operations/control-access/rbac/